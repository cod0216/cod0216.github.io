---
title: 대규모 트래픽 자리 예약 시스템 - 이해하기
date: 2025-02-01 00:00:00 +0900
categories: [Architecture, Ticket]
tags: [Architecture, Ticket, load]
toc: true
comments: true
---


## 왜 이런 시스템이 필요한가 (문제의 본질)

예매(티켓/좌석) 시스템은 트래픽이 폭발하는 순간이 있습니다. 대표적으로 콘서트, KTX/항공, 인기 강의 수강신청 등이 그렇습니다.

이때 시스템이 반드시 만족해야 하는 요구사항이 4가지입니다.

1. **순서 보장(선착순)**: 늦게 들어온 사람이 먼저 처리되면 신뢰가 무너집니다.
2. **초과 예매 방지**: 좌석 100석이면 100건까지만 확정되어야 합니다.
3. **중복 예매 방지**: 한 사람이 여러 번 중복으로 잡거나(동시 클릭/재시도) 같은 좌석이 여러 사람에게 잡히면 안 됩니다.
4. **DB 보호**: 순간 트래픽이 DB로 그대로 들어가면 DB 병목 → 전체 장애로 이어집니다.

즉, **정합성(Consistency),** **선착순(Fairness),** **DB 부하 제어(Load Shedding)**를 동시에 만족해야 하는 고난도 문제입니다.

## 일반적인 3티어는 과도한 트래픽에 괜찮을까?

일반적인 구조는 이렇습니다.

![1](/assets/img/ticket-1/1.png)

평상시 트래픽에서는 큰 문제가 없습니다.

하지만 “동시 수만~수십만 요청”이 몰리는 순간, 구조적 한계가 드러납니다.

- API 서버는 스케일 아웃으로 어느 정도 대응할 수 있습니다.
- 그러나 **DB는 무한정 확장할 수 없습니다.**
    - 스케일 업: 비용 급증
    - 스케일 아웃(샤딩): 트랜잭션·정합성·쿼리 복잡도 급상승

결국 문제의 본질은 **API 서버 수가 아니라, DB로 유입되는 트래픽의 양**입니다.

따라서 예매 시스템에는 DB로 가는 요청 자체를 통제하는 장치가 반드시 필요합니다.

## 해결 방법 - 대기열, 입장제어, 원자적 차감

핵심 아이디어는 단순합니다.

- 모든 요청을 DB로 보내지 않는다.
- 먼저 줄을 세우고,
- 처리 가능한 만큼만 입장시키며,
- 좌석 차감은 반드시 원자적으로 처리한다.

이 아이디어가 3단계로 정리됩니다.

1. **대기열(Queue In)**: 일단 줄 세우기
2. **입장 제어(Admission Control)**: 한 번에 들어올 인원 제한
3. **예매 처리(Atomic Reservation)**: 초과와 중복을 원자적으로 막기

## 전체 아키텍처 개요

![2](/assets/img/ticket-1/2.png)

정리해보면 위 그림처럼 추상적인 아키텍처를 그릴 수 있습니다.
